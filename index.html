<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TT Mart</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(to bottom right, #fef6e4, #fde2e4, #cddafd);
      background-attachment: fixed;
      background-size: cover;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
    }
    h1 {
      color: #444;
      margin: 0;
    }
    .cart-icon {
      position: relative;
      font-size: 20px;
      cursor: pointer;
    }
    .cart-count {
      position: absolute;
      top: -10px;
      right: -10px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
    }
    #search {
      display: block;
      margin: 0 auto 20px;
      padding: 10px;
      width: 90%;
      max-width: 400px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .product-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .product {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      gap: 15px;
      align-items: center;
    }
    .product img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
    }
    .product-info {
      flex: 1;
    }
    .product-title {
      font-size: 18px;
      font-weight: bold;
      margin: 0 0 5px;
    }
    .product-description {
      margin: 0 0 5px;
      color: #666;
    }
    .product-price {
      font-weight: bold;
      color: #222;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .cart {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .cart h2 {
      margin-top: 0;
    }
    .cart-item {
      margin-bottom: 10px;
    }
    .success-message {
      color: green;
      font-weight: bold;
      margin-top: 10px;
    }
    button {
      padding: 5px 10px;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>TT Mart</h1>
    <div class="cart-icon">ðŸ›’<span id="cart-count" class="cart-count">0</span></div>
  </header>
  <input type="text" id="search" placeholder="Search products..." />
  <div class="product-list" id="product-list"></div>

  <div class="cart">
    <h2>Your Cart</h2>
    <form id="order-form" action="https://formsubmit.co/nalae1270@gmail.com" method="POST">
      <div id="cart-items"></div>
      <input type="hidden" name="products" id="product-input" />
      <input type="text" name="name" placeholder="Your name" required /> <br><br>
      <input type="email" name="email" placeholder="Your email" required /> <br><br>
      <button type="submit">Submit Order</button>
    </form>
    <div id="success-message" class="success-message" style="display: none;">Thank you! Your order has been submitted.</div>
  </div>

  <script>
    const url = 'https://docs.google.com/spreadsheets/d/1GYwBQ0THPAD-1A0CgaOq9M3-r0hak8omAu4iGOjsMs0/gviz/tq?tqx=out:csv';
    const productList = document.getElementById('product-list');
    const searchInput = document.getElementById('search');
    const cartItemsDiv = document.getElementById('cart-items');
    const productInput = document.getElementById('product-input');
    const cartCount = document.getElementById('cart-count');
    const successMessage = document.getElementById('success-message');
    let cart = {};

    function updateCartDisplay() {
      cartItemsDiv.innerHTML = Object.entries(cart).map(([key, item]) =>
        `<div class="cart-item">${item.quantity} x ${item.name} (${item.price})</div>`
      ).join('');
      productInput.value = Object.entries(cart).map(([key, item]) => `${item.quantity} x ${item.name}`).join('\n');
      const totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
      cartCount.textContent = totalItems;
    }

    function addToCart(product) {
      const key = product.name;
      if (cart[key]) {
        cart[key].quantity++;
      } else {
        cart[key] = { ...product, quantity: 1 };
      }
      updateCartDisplay();
    }

    function createQuantityControls(product) {
      const container = document.createElement('div');
      container.className = 'quantity-controls';
      let quantity = 1;

      const minusBtn = document.createElement('button');
      minusBtn.type = 'button';
      minusBtn.textContent = '-';
      minusBtn.onclick = () => {
        if (quantity > 1) quantity--;
        quantityDisplay.textContent = quantity;
      };

      const quantityDisplay = document.createElement('span');
      quantityDisplay.textContent = quantity;

      const plusBtn = document.createElement('button');
      plusBtn.type = 'button';
      plusBtn.textContent = '+';
      plusBtn.onclick = () => {
        quantity++;
        quantityDisplay.textContent = quantity;
      };

      const addBtn = document.createElement('button');
      addBtn.type = 'button';
      addBtn.textContent = 'Add to Cart';
      addBtn.onclick = () => {
        for (let i = 0; i < quantity; i++) addToCart(product);
      };

      container.append(minusBtn, quantityDisplay, plusBtn, addBtn);
      return container;
    }

    document.getElementById('order-form').addEventListener('submit', function(e) {
      successMessage.style.display = 'block';
      setTimeout(() => { successMessage.style.display = 'none'; }, 5000);
    });

    fetch(url)
      .then(res => res.text())
      .then(text => {
        const rows = text.trim().split('\n').map(line => line.split(','));
        const products = rows.slice(1).map(row => {
          return {
            name: row[0].replace(/^"|"$/g, ''),
            description: row[1].replace(/^"|"$/g, ''),
            price: row[2].replace(/^"|"$/g, ''),
                        image: row[4] ? row[4].replace(/^"|"$/g, '') : ''
          };
        });

        function renderProducts(filter = '') {
          const filtered = products.filter(p =>
            p.name.toLowerCase().includes(filter.toLowerCase()) ||
            p.description.toLowerCase().includes(filter.toLowerCase())
          );

          productList.innerHTML = '';
          filtered.forEach(p => {
            const productDiv = document.createElement('div');
            productDiv.className = 'product';

            if (p.image) {
              const img = document.createElement('img');
              img.src = p.image;
              img.alt = p.name;
              productDiv.appendChild(img);
            }

            const infoDiv = document.createElement('div');
            infoDiv.className = 'product-info';
            infoDiv.innerHTML = `
              <div class="product-title">${p.name}</div>
              <div class="product-description">${p.description}</div>
              <div class="product-price">${p.price}</div>
                          `;
            infoDiv.appendChild(createQuantityControls(p));
            productDiv.appendChild(infoDiv);

            productList.appendChild(productDiv);
          });
        }

        searchInput.addEventListener('input', e => {
          renderProducts(e.target.value);
        });

        renderProducts();
      });
  </script>
</body>
</html>
